{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ketis\\\\Documents\\\\estenligne\\\\ReactSPA\\\\src\\\\components\\\\Pages\\\\LoginPage\\\\LoginPage.tsx\";\nimport { Component } from \"react\";\nimport { Link, Redirect } from 'react-router-dom';\nimport Cookies from \"universal-cookie\";\nimport LoginForm from \"./LoginForm/LoginForm\";\nimport FormMessage from \"../../shared/formmessage/FormMessage\";\nimport PageName from '../../shared/pagename/PageName';\nimport { VerticalLogo } from \"../../shared/logo/Logos\";\nimport { postOrUpdateRequest } from \"../../shared/utils/functions\";\nimport settings from './../../../settings.json';\nimport './LoginPage.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass LoginPage extends Component {\n  constructor(...args) {\n    super(...args);\n    this._alertMessage = \"Use either email or phone number\";\n    this._alertType = \"error\";\n    this.cookies = new Cookies();\n    this.settings = settings;\n    this.state = {\n      isAuthenticated: false,\n      nextPage: '',\n      alertMessage: this._alertMessage,\n      alertType: this._alertType\n    };\n    this.props = this.props;\n\n    this.submitForm = data => {\n      var newData = {};\n      var identity = data.phoneNumber;\n\n      if (data.email != null) {\n        newData = {\n          email: data.email,\n          password: data.password,\n          rememberMe: true\n        };\n      } else newData = {\n        phoneNumber: data.phoneNumber,\n        password: data.password,\n        rememberMe: true\n      };\n\n      data.remenberMe = true;\n      fetch(`${this.settings.host}/api/account/signin`, {\n        \"method\": \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"accept\": \"application/json\"\n        },\n        body: JSON.stringify(newData)\n      }).then(response => response.json()).then(result => {\n        // console.log(result)\n        let keys = Object.keys(result); // console.log(keys)\n\n        if (keys.includes(\"token\")) {\n          var _result$token;\n\n          this.setState({\n            isAuthenticated: true,\n            alertType: 'success',\n            alertMessage: `Successfull login ${result.userName} you will be redirect soon`\n          });\n          let date = new Date();\n          let expirationDate = new Date();\n          expirationDate.setMinutes(date.getMinutes() + 7 * 24 * 60);\n          this.cookies.set(\"isAuthenticated\", true, {\n            sameSite: true,\n            expires: expirationDate\n          });\n          this.cookies.set(\"userId\", result.id, {\n            sameSite: true,\n            expires: expirationDate\n          });\n          this.cookies.set(\"identity\", identity, {\n            sameSite: true,\n            expires: expirationDate\n          });\n          this.cookies.set(\"token\", result.token, {\n            sameSite: true,\n            expires: expirationDate\n          });\n          postOrUpdateRequest(`${this.settings.host}/api/DeviceUsed?devicePlatform=4`, \"PUT\", {}, (_result$token = result.token) !== null && _result$token !== void 0 ? _result$token : \"\", res => {\n            let _keys = Object.keys(res);\n\n            if (_keys.includes(\"id\") && keys.includes(\"userProfileId\")) {\n              this.cookies.set(\"userProfileId\", result.userProfileId, {\n                sameSite: true,\n                expires: expirationDate\n              });\n              this.setState({\n                nextPage: \"home\"\n              });\n            } else this.setState({\n              nextPage: \"profile\"\n            });\n          }, res => {\n            this.setState({\n              alertMessage: \"Error something append wrong with query\"\n            });\n          });\n\n          try {\n            this.props.changeAuthenticationState(true, result.id);\n          } catch (error) {}\n        } else this.setState({\n          isAuthenticated: false,\n          alertType: 'error',\n          alertMessage: `Error! ${result}`\n        });\n      }, error => {\n        this.setState({\n          isAuthenticated: false,\n          alertType: 'error',\n          alertMessage: `Something append wrong ${error}`\n        });\n      });\n    };\n  }\n\n  render() {\n    console.log(this.state.nextPage + '-page');\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"login-page\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title\",\n        children: /*#__PURE__*/_jsxDEV(PageName, {\n          name: \"Login\"\n        }, \"login-page-name\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }, this)\n      }, \"login-page-name-section\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content\",\n        children: [/*#__PURE__*/_jsxDEV(VerticalLogo, {}, \"login-page-logo\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(FormMessage, {\n          type: this.state.alertType,\n          message: this.state.alertMessage\n        }, \"login-page-alert-message\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(LoginForm, {\n          submitForm: this.submitForm\n        }, \"login-page-form\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/resetpassword\",\n          className: \"fs-6 fw-bold link-secondary\",\n          children: ['>', \" Forgot Password \", '<']\n        }, \"login-page-link1\", true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/register\",\n          className: \"fs-5 fw-bold link-secondary\",\n          children: ['>>', \" Create Account \", '<<']\n        }, \"login-page-link2\", true, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 21\n        }, this)]\n      }, \"login-page-tools-sections\", true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }, this), this.state.nextPage === 'profile' ? /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/shortprofile\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 56\n      }, this) : this.state.nextPage === 'home' ? /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/home\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 124\n      }, this) : null]\n    }, \"login-page\", true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default LoginPage;","map":{"version":3,"sources":["C:/Users/ketis/Documents/estenligne/ReactSPA/src/components/Pages/LoginPage/LoginPage.tsx"],"names":["Component","Link","Redirect","Cookies","LoginForm","FormMessage","PageName","VerticalLogo","postOrUpdateRequest","settings","LoginPage","_alertMessage","_alertType","cookies","state","isAuthenticated","nextPage","alertMessage","alertType","props","submitForm","data","newData","identity","phoneNumber","email","password","rememberMe","remenberMe","fetch","host","headers","body","JSON","stringify","then","response","json","result","keys","Object","includes","setState","userName","date","Date","expirationDate","setMinutes","getMinutes","set","sameSite","expires","id","token","res","_keys","userProfileId","changeAuthenticationState","error","render","console","log"],"mappings":"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","sourcesContent":["import { Component } from \"react\";\r\nimport { Link, Redirect } from 'react-router-dom';\r\nimport Cookies from \"universal-cookie\";\r\n\r\nimport LoginForm from \"./LoginForm/LoginForm\";\r\nimport FormMessage from \"../../shared/formmessage/FormMessage\";\r\n\r\nimport PageName from '../../shared/pagename/PageName';\r\nimport {VerticalLogo} from \"../../shared/logo/Logos\";\r\nimport { Credential } from \"../../shared/utils/Types\";\r\n\r\n\r\nimport { postOrUpdateRequest } from \"../../shared/utils/functions\";\r\nimport settings from './../../../settings.json';\r\n\r\nimport './LoginPage.css'\r\n\r\nclass LoginPage extends Component{\r\n    _alertMessage = \"Use either email or phone number\"\r\n    _alertType = \"error\"\r\n    cookies = new Cookies()\r\n    settings = settings\r\n    state = {\r\n        isAuthenticated: false,\r\n        nextPage:'',\r\n        alertMessage: this._alertMessage,\r\n        alertType: this._alertType\r\n    }\r\n    props:any = this.props\r\n\r\n    submitForm = (data:Credential) => {\r\n        var newData = {}\r\n        var identity = data.phoneNumber\r\n        if(data.email != null)\r\n        {\r\n            newData = {email:data.email, password:data.password, rememberMe: true}\r\n        }\r\n        else        \r\n            newData = {phoneNumber:data.phoneNumber, password:data.password, rememberMe: true}\r\n        \r\n        data.remenberMe = true\r\n        fetch(`${this.settings.host}/api/account/signin`, {\r\n            \"method\": \"POST\",\r\n            headers: {\r\n                \"content-type\": \"application/json\",\r\n                \"accept\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(newData)\r\n            }).then(response => response.json())\r\n            .then(\r\n                (result) => {\r\n                    // console.log(result)\r\n                    let keys = Object.keys(result)\r\n                    // console.log(keys)\r\n                    if(keys.includes(\"token\"))\r\n                    {\r\n                        this.setState({isAuthenticated: true, alertType : 'success',  alertMessage: `Successfull login ${result.userName} you will be redirect soon`})\r\n                        let date = new Date()\r\n                        let expirationDate = new Date()\r\n                        expirationDate.setMinutes(date.getMinutes() + 7 * 24 * 60)\r\n                        this.cookies.set(\"isAuthenticated\", true, {sameSite: true, expires:expirationDate })\r\n                        this.cookies.set(\"userId\", result.id, {sameSite: true, expires:expirationDate })\r\n                        this.cookies.set(\"identity\", identity, {sameSite: true, expires:expirationDate })\r\n                        this.cookies.set(\"token\", result.token, {sameSite: true, expires:expirationDate })\r\n                        \r\n                        postOrUpdateRequest(`${this.settings.host}/api/DeviceUsed?devicePlatform=4`, \"PUT\", {}, result.token??\"\", (res:any)=>{\r\n                            let _keys = Object.keys(res);\r\n                            if(_keys.includes(\"id\") && keys.includes(\"userProfileId\"))\r\n                            {\r\n                                this.cookies.set(\"userProfileId\", result.userProfileId, {sameSite: true, expires:expirationDate })\r\n                                this.setState({nextPage: \"home\"})\r\n                            }\r\n                            else\r\n                                this.setState({nextPage: \"profile\"})\r\n                        }, (res:any)=>{\r\n                            this.setState({alertMessage: \"Error something append wrong with query\"})\r\n                        })\r\n                        try {\r\n                            this.props.changeAuthenticationState(true, result.id)\r\n                        } catch (error) {}\r\n                    }\r\n                    else\r\n                        this.setState({isAuthenticated: false, alertType : 'error',  alertMessage: `Error! ${result}`})\r\n                },\r\n                (error) => {\r\n                    this.setState({isAuthenticated: false, alertType : 'error',  alertMessage: `Something append wrong ${error}`})\r\n                }\r\n            );\r\n    }\r\n\r\n    render(){\r\n        console.log(this.state.nextPage+'-page')\r\n        return (\r\n            <div className = \"login-page\" key=\"login-page\">\r\n                <div className=\"title\" key=\"login-page-name-section\">\r\n                    <PageName name=\"Login\" key = \"login-page-name\"/>\r\n                </div>\r\n                <div className = \"content\" key=\"login-page-tools-sections\">\r\n                    <VerticalLogo key = \"login-page-logo\"/>\r\n                    <FormMessage type={this.state.alertType} message = {this.state.alertMessage} key = \"login-page-alert-message\"/>\r\n                    <LoginForm submitForm = {this.submitForm} key = \"login-page-form\"/>\r\n                    <Link to = '/resetpassword' key = \"login-page-link1\" className = \"fs-6 fw-bold link-secondary\">{'>'} Forgot Password {'<'}</Link>\r\n                    <Link to = \"/register\" key = \"login-page-link2\" className=\"fs-5 fw-bold link-secondary\">{'>>'} Create Account {'<<'}</Link>\r\n                </div>\r\n                {((this.state.nextPage === 'profile')?(<Redirect to=\"/shortprofile\" />):((this.state.nextPage === 'home')?(<Redirect to=\"/home\" />):(null)))}\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default LoginPage"]},"metadata":{},"sourceType":"module"}